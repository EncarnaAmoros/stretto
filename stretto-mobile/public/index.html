<!DOCTYPE html> 
<html lang="en" ng-app="strettoApp">
<html>
<head>
		<title>Stretto</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
		<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
		<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>

		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta name="author" content="encaramorosb@gmail.com">
		<meta name="description" content="SPA Stretto">
		<meta name="keywords" content="tienda, instrumentos, musica">
		<meta name="copyright" content="2015 Stretto">

		<!-- Include Require -->
		<!--<script type="text/javascript" src="/aplicacion/lib/require.js"></script>-->
		<script type="text/javascript" src="/lib/require.js"></script>
		<!-- Include JQuery -->
		<!--<script type="text/javascript" src="/lib/jquery-1.11.3.min.js"></script>-->
		<!-- Include Bootstrap js y css -->
		<link rel="stylesheet" href="/lib/bootstrap.min.js">
		<link rel="stylesheet" href="/css/bootstrap.min.css">
		<link rel="stylesheet" href="/css/index.css">
		<!-- Include Angular -->
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.7/angular.min.js"></script>
		<!-- Include Angular para rutas -->
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.7/angular-route.js"></script>
		<!-- Include Angular UI -->
		<script src="/lib/ui-bootstrap-tpls-0.14.3.min.js"></script>
	
		<!-- Incuir los CSS estilos -->
		<link rel="stylesheet" href="/css/articulos-list.css">
		<link rel="stylesheet" href="/css/login.css">
		<link rel="stylesheet" href="/css/*.css">
</head>
<body>
	
	<!-- PAGINA ARTICULOS GENERAL -->
	<div data-role="page" ng-controller="ArticulosCtrl" id="principal">
			<div data-role="header">
					<h1>Stretto</h1>
			</div>
			<div role="main" class="ui-content">
					Estos son los ultimos artículos, ir a tus <a href="#misarticulos" data-transition="flip"> articulos</a>
					Ve a tu <a href="#usuariodetalle" data-transition="flip"> perfil</a>
					o <a href="#login" data-transition="flip">inicia sesión</a>
					o <a href="#registro" data-transition="flip">Registrate!</a>
			</div>
			<div>
				<div>	
					<!-- Filtros de búsqueda -->
					<div>
						<h5>Busca por nombre:</h5>
						<div class="input-group">
							<input ng-model="filtronombre" class="form-control" placeholder="Busca por...">
						</div>

						<h5>Tipo de instrumento:</h5>
						<select ng-model="filtrotipo" class="form-control">
							<option value="" id="defaulselect">Selecciona un tipo</option>
							<option ng-repeat="tipo in tipos" value={{tipo.nombre}}>{{tipo.nombre}}</option>
						</select>			
					</div>
					<!-- Lista con artículos y paginado -->
					<div class="media" ng-repeat="articulo in articulos | filter:filtronombre | filter:filtrotipo"> 
						<!-- Vista de cada artículo -->
						<div class="panel panel-default">
							<div class="panel-body">
								<a ng-click="seleccionarArticulo(articulo)" class="pull-left">
									<img src="{{articulo.foto}}" class="media-object" id="fotos-articulos" alt="{{articulo.nombre}}">
								</a>
								<div class="media-body">
									<h4 class="media-heading">{{articulo.nombre}}<i id="precio">{{articulo.precio}} €</i></h4>
									<p>{{articulo.descripcion}}</p>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div data-role="footer" data-position="fixed">
					<h2>Esto es el pie</h2>
			</div>
	</div>
	
	<!-- PAGINA ARTICULOS DEL USUARIO LOGEADO -->

	<div data-role="page" ng-controller="UsuarioArticulosCtrl" id="articulosusuario">
			<div data-role="header">
					<h1>Stretto</h1>
			</div>
			<div role="main" class="ui-content">
					Estos son mis artículos, ir a 
				<a href="#principal" data-transition="flip"> principal</a>
				<a href="#perfil" data-transition="flip"> perfil</a>
			</div>
				<div>	
					<!-- Filtros de búsqueda -->
					<div>
						<h5>Busca por nombre:</h5>
						<div class="input-group">
							<input ng-model="filtronombre" class="form-control" placeholder="Busca por...">
						</div>

						<h5>Tipo de instrumento:</h5>
						<select ng-model="filtrotipo" class="form-control">
							<option value="" id="defaulselect">Selecciona un tipo</option>
							<option ng-repeat="tipo in tipos" value={{tipo.nombre}}>{{tipo.nombre}}</option>
						</select>			
					</div>
					<!-- Mostramos la lista de los artículos pudiendo editar y eliminar porque son suyos --> 
					<div class="media" ng-repeat="articulo in articulos | filter:filtronombre | filter:filtrotipo">			
						<div class="panel panel-default">

							<!-- Vista de los artículos en detalle -->
							<div class="panel-body">
								<a href="#" ng-click="seleccionarArticulo(articulo)" class="pull-left">
									<img src="{{articulo.foto}}" class="media-object" id="fotos-articulos" alt="{{articulo.nombre}}">
								</a>

								<div class="media-body">
									<h4 class="media-heading">{{articulo.nombre}}
										<i id="precio">{{articulo.precio}} €</i>
									</h4>
									<p id="descripcion">{{articulo.descripcion}}</p>
								</div>				

								<!--No los mostramos si los artículos son de un usuario que no es el logeado -->
								<div>
									<a data-role="button" ng-click="editarArticulo(articulo)" href="#" class="btn btn-primary">
										Editar <span class="glyphicon glyphicon-pencil"></span>
									</a>
									<a data-role="button" ng-click="deleteArticulo(articulo.id)"
										 id="botonderecha" class="btn btn-primary" id="botonDetecha">
										Eliminar <span class="glyphicon glyphicon-trash"></span>
									</a>
								</div>
							</div>						
						</div>		
					</div>
			</div>
			<div data-role="footer" data-position="fixed">
					<h2>Esto es el pie</h2>
			</div>
	</div>

	
	<!-- PAGINA ARTICULO EDITABLE DEL USUARIO LOGEADO -->

	<div data-role="page" ng-controller="UsuarioArticuloEditarCtrl" id="articuloeditable">
			<div data-role="header">
					<h1>Stretto</h1>
			</div>
			<div role="main" class="ui-content">
					Estos son mis artículos, ir a 
				<a href="#principal" data-transition="flip"> principal</a>
				<a href="#perfil" data-transition="flip"> perfil</a>
			</div>			
				<div class="media">			
					<div class="panel panel-default">

						<!-- Vista de los artículo para editar -->
						<div class="panel-body">
							<a href="" class="pull-left" id="imagenArtEdit">
								<img src="{{imagenPorDefecto}}" class="media-object" id="fotos-articulos" alt="Imagen por defecto">
							</a>
							<label>URL foto:</label>
							<input ng-model=articulo.foto class="form-control" id="inputformArtBig" placeholder="URL foto del artículo">
							<div class="media-body">
								<div id="nombreEdit">
									<label>Nombre:</label>
									<input ng-model=articulo.nombre class="form-control" placeholder="Nombre">
								</div>
								<div id="precioEdit">
									<label id="etiquetaPrecioEdit">Precio:</label>
									<input ng-model=articulo.precio class="form-control" placeholder="Precio">
								</div>
								<div>
									<label id="etiquetaPrecioEdit">Tipo:</label>
									<select ng-model="articulo.tipo" class="form-control" id="inputformArtSmall">
										<option value="" id="defaulselect">Selecciona un tipo</option>
										<option ng-repeat="tipo in tipos" value={{tipo.nombre}}>{{tipo.nombre}}</option>
									</select>	
								</div>
								<label>Descripción:</label>
								<textarea rows="3" ng-model=articulo.descripcion class="form-control" 
													id="inputformArtBig" placeholder="Descripción">
								</textarea>
								<a data-role="button" ng-click="updateArticulo(articulo)" class="btn btn-primary">
									Guardar <span class="glyphicon glyphicon-floppy-saved"></span>
								</a>	
								<a data-role="button" href="#articulosusuario" class="btn btn-primary" id="botonDetecha">
									Cancelar <span class="glyphicon glyphicon-arrow-left"></span>
								</a>
							</div>						
						</div>
					</div>		
				</div>
			<div data-role="footer" data-position="fixed">
					<h2>Esto es el pie</h2>
			</div>
	</div>
	
	
	<!-- PAGINA ARTICULO EN DETALLE -->
	<div data-role="page" ng-controller="ArticuloCtrl" id="articulodetalle">
			<div data-role="header">
					<h1>Artículo</h1>
					<a href="#principal" data-rel="back" 
					data-icon="carat-l">Atrás</a>
			</div>
			<div role="main" class="ui-content">
					Artículo en detalle 
			</div>
			<div>
				<div class="media" id="divArticuloDetalle">		
					<!-- Vista del artículo en detalle -->
					<a ng-click="seleccionarArticulo(articulo)" href="#" class="pull-left">
						<img src="{{articulo.foto}}" class="media-object" id="fotos-articulos" alt="{{articulo.nombre}}">
					</a>

					<div class="media-body">
						<h4 class="media-heading" id="nombreprecio">{{articulo.nombre}}
							<i id="precio">{{articulo.precio}} €</i>
						</h4>
						<p id="descripcion">{{articulo.descripcion}}</p>
						<p id="vendedor">Vendedor: 
							<a ng-click="seleccionarUsuario(usuario)" href="#">{{usuario.nombre}} - {{usuario.email}}</a>
						</p>

					</div>	

					<a ng-click='comprarArticulo()' href="#" data-role="button" class="btn btn-primary">
						Comprar <span class="glyphicon glyphicon-shopping-cart"></span>
					</a>

					<div id="divmensaje" class="mensajeoculto"><div class="alert alert-success" id="mensaje">{{mensaje}}</div></div>
				</div>
			</div>
			<div data-role="footer" data-position="fixed">
					<h2>Esto es el pie</h2>
			</div>
	</div>
	
	<!-- PAGINA LOGIN -->
	<div data-role="page" ng-controller="LoginCtrl" id="login">
			<div data-role="header">
					<h1>Stretto</h1>
					<a href="#principal" data-rel="back" data-icon="carat-l">Atrás</a>
			</div>
			<div role="main" class="ui-content">
				Iniciar sesión 
			</div>
			<div>
				<div>
						<h5>Email:</h5>
						<div class="input-group">
							<input ng-model="datos.email" type="text" class="form-control" placeholder="usuario@...">
						</div>
						<h5>Contraseña:</h5>
						<div class="input-group">
							<input ng-model="datos.password" type="password" class="form-control" placeholder="***...">
						</div>
						<a ng-click='login()' href="#" data-role="button" data-transition="flip">Iniciar sesión</a>
						<div id="divmensajelogin" class="mensajeoculto">
							<div class="alert alert-success" id="mensajelogin">{{mensaje}}</div>
						</div>
				</div>
			</div>
			
			<div data-role="footer" data-position="fixed">
					<h2>Esto es el pie</h2>
			</div>
	</div>	
		
	
	<!-- PAGINA PERFIL DEL USUARIO LOGEADO -->
	
	<div data-role="page" ng-controller="UsuarioCtrl" id="usuariodetalle">
			<div data-role="header">
					<h1>Stretto</h1>
					<a href="#principal" data-rel="back" 
					data-icon="carat-l">Atrás</a>
			</div>
			<div role="main" class="ui-content">
				<!-- Vista del usuario en detalle -->
				<h5 class="titulo" id="tituloprincipal">Datos personales - 
					<a ng-click="seleccionarUsuario(usuario)" href="#" class="titulolink">Todos los artículos vendidos por {{usuario.nombre}}</a>
					<a href="#perfil" class="titulolink">Tu perfil</a>
				</h5>
				<!-- Vista usuario detalle -->
				<fieldset class="marco_principal">
					<p class="etiqueta">Nombre: </p>
					<h5 class="datos_u">{{usuario.nombre}}</h5> </br>

					<p class="etiqueta">Email: </p>
					<h5 class="datos_u">{{usuario.email}}</h5> </br>

					<p class="etiqueta">Valoración: </p>
					<h5 class="datos_u">{{usuario.valoracion}}</h5> </br>

					<p class="etiqueta">Teléfono: </p>
					<h5 class="datos_u">{{usuario.tlf}}</h5> </br>

					<button ng-click="editableView()" class="btn btn-primary">
						Editar perfil <span class="glyphicon glyphicon-pencil"></span>
					</button>
					<button ng-click="deleteUsuario(usuario.id)" id="botonderecha" class="btn btn-primary" id="botonDetecha">
						Eliminar cuenta <span class="glyphicon glyphicon-trash"></span>
					</button>
				</fieldset>

				<!-- Vista usuario editar -->
				<fieldset class="marco_principal">
					<label>Nombre:</label>
					<input ng-model=usuario.nombre class="form-control" placeholder="Ej: Carlos Álvarez">

					<label>Email:</label>
					<input ng-model=usuario.email class="form-control" placeholder="Ej: nombre@servicio.com">

					<label>Teléfono:</label>
					<input ng-model=usuario.tlf class="form-control" placeholder="Ej: 667746213">

					<label>Contraseña:</label>
					<input ng-model=usuario.password class="form-control" type="password" placeholder="*****">

					<button ng-click="updateUsuario(usuario)" class="btn btn-primary">
						Guardar <span class="glyphicon glyphicon-floppy-saved"></span>
					</button>	
					<button ng-click="cancelarEdit()" class="btn btn-primary" id="botonDetecha">
						Cancelar <span class="glyphicon glyphicon-arrow-left"></span>
					</button>
				</fieldset>
				<div id="divmensaje" class="mensajeoculto"><div class="alert alert-success" id="mensaje">{{mensaje}}</div></div>
			</div>
			<div data-role="footer" data-position="fixed">
					<h2>Esto es el pie</h2>
			</div>
	</div>


	<!-- PAGINA REGISTRO -->
	
	<div data-role="page" id="registro">
			<div data-role="header">
					<h1>Stretto</h1>
					<a href="#principal" data-rel="back" 
					data-icon="carat-l">Atrás</a>
			</div>
			<div role="main" class="ui-content">
				<p class="text-muted">Crea tu propia cuenta introduciendon los siguientes datos.</p>
				<div class="modal-body">
					<form action="" role="form" onsubmit="return false;">
							<div class="form-group">
									<label for="nombre">Nombre:</label>
									<input type="text" id="nombre" ng-model="datos.nombre" placeholder="Ej: Antonio" class="form-control">
							</div>
							<div class="form-group">
									<label for="email">Email:</label>
									<input type="text" id="email" ng-model="datos.email" placeholder="tucorreo@gmail.com" class="form-control">
							</div>
							<div class="form-group">
									<label for="nombre">Teléfono:</label>
									<input type="text" id="tlf" ng-model="datos.tlf" placeholder="Ej: 786543211" class="form-control">
							</div>
							<div class="form-group">
									<label for="password">Contraseña:</label>
									<input type="password" id="password" ng-model="datos.password" class="form-control">
							</div>
					</form>
					<a ng-click="#login">¡Iniciar sesión!</a>

					<div id="divmensajeregistro" class="mensajedesaparece"><div id="mensajeregistro"></div></div>
				</div>
				<div class="modal-footer">
						<button class="btn btn-primary" href="#" id="botonRegistro">Registrarme</button>
				</div>

				<script type="text/javascript" src="/js/registro-sinframework.js"></script>
			</div>
			<div data-role="footer" data-position="fixed">
					<h2>Esto es el pie</h2>
			</div>
	</div>

	
	<!-- EJEMPLO SECUNDARIA -->
	<div data-role="page" id="secundaria">
			<div data-role="header">
					<h1>Secundaria</h1>
					<a href="#principal" data-rel="back" 
					data-icon="carat-l">Atrás</a>
			</div>
			<div role="main" class="ui-content">
					Esto el contenido secundario 

			</div>
			<div data-role="footer" data-position="fixed">
					<h2>Esto es el pie</h2>
			</div>
	</div>
	
	<!-- Include App -->
	<script src="/js/app.js"></script>
	<!-- Include Controladores -->
	<script src="/js/controllers.js"></script>
	<!-- Incluimos servicios -->
	<script src="/js/strettoService.js"></script>
	
	<script type="text/javascript">
		window.addEventListener('pageshow', function() {
			console.log("Se muestra la página secundaria");	
		});
		/*$('#principal').on('pagebeforeshow', function() {
			//$scope.actualizar();
			angular.element('#principal').scope().actualizar();
		});*/
		$('#articulosusuario').on('pagebeforeshow', function() {
			//$scope.actualizar();
			angular.element('#articulosusuario').scope().actualizar();
		});
		/*$('#articulodetalle').on('pagebeforeshow', function() {
			//$scope.actualizar();
			angular.element('#articulodetalle').scope().actualizar();
		});*/
		$('#usuariodetalle').on('pagebeforeshow', function() {
			//$scope.actualizar();
			angular.element('#usuariodetalle').scope().actualizar();
		});
	</script>
	
</body>	
</html>

